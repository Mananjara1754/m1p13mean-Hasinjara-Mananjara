<div class="page-container" *ngIf="user">
  <div class="page-header">
    <h1>Paramètres</h1>
    <p class="text-muted">Gérez les informations de votre compte et de votre boutique.</p>
  </div>

  <div class="settings-grid">
    <!-- Profil / Sécurité -->
    <div class="settings-section glass">
      <div class="section-header">
        <span class="icon"><img src="assets/image/icons/ic_users.svg" alt=""></span>
        <h3>Sécurité du compte</h3>
      </div>

      <form (ngSubmit)="changePassword()" class="settings-form">
        <div class="form-group">
          <label>Mot de passe actuel</label>
          <input type="password" [(ngModel)]="passwordData.currentPassword" name="currentPassword" required
            class="input-control">
        </div>

        <div class="form-group">
          <label>Nouveau mot de passe</label>
          <input type="password" [(ngModel)]="passwordData.newPassword" name="newPassword" required
            class="input-control">
        </div>

        <div class="form-group">
          <label>Confirmer le nouveau mot de passe</label>
          <input type="password" [(ngModel)]="passwordData.confirmPassword" name="confirmPassword" required
            class="input-control">
        </div>

        <div class="form-actions mt-4">
          <button type="submit" class="btn-primary" [disabled]="isChangingPassword">
            {{ isChangingPassword ? 'Mise à jour...' : 'Changer le mot de passe' }}
          </button>
        </div>
      </form>
    </div>

    <!-- Boutique (pour les rôles shop) -->
    <div class="settings-section glass" *ngIf="user.role === 'shop' && shop">
      <div class="section-header">
        <span class="icon"><img src="assets/image/icons/ic_shop.svg" alt=""></span>
        <h3>Informations de la boutique</h3>
      </div>

      <form (ngSubmit)="saveShop()" class="settings-form">
        <div class="shop-header-edit">
          <div class="logo-upload">
            <img [src]="shop.logo ? 'http://localhost:5000/' + shop.logo : 'assets/image/placeholder_shop.png'"
              alt="Logo" class="current-logo">
            <div class="upload-overlay">
              <input type="file" (change)="onLogoSelected($event)" id="logoInput" hidden accept="image/*">
              <label for="logoInput" class="upload-btn">Changer le logo</label>
            </div>
          </div>
          <div class="shop-name-desc">
            <div class="form-group">
              <label>Nom de la boutique</label>
              <input type="text" [(ngModel)]="shop.name" name="shopName" required class="input-control">
            </div>
            <div class="form-group">
              <label>Description</label>
              <textarea [(ngModel)]="shop.description" name="shopDesc" rows="3" class="input-control"></textarea>
            </div>
          </div>
        </div>

        <div class="form-group mt-4">
          <label>Catégorie</label>
          <select [(ngModel)]="shop.category_id" name="category" class="input-control">
            <option *ngFor="let cat of categories" [value]="cat._id">{{ cat.name }}</option>
          </select>
        </div>

        <!-- Opening Hours -->
        <div class="hours-section mt-6" *ngIf="shop.opening_hours">
          <label class="section-label">Heures d'ouverture</label>
          <div class="hours-grid">
            <div *ngFor="let day of days" class="hour-row">
              <span class="day-name">{{ dayNames[day] || (day | titlecase) }}</span>
              <div class="time-inputs" [class.disabled]="shop.opening_hours[day]?.is_closed">
                <input type="time" [(ngModel)]="shop.opening_hours[day]!.open" [name]="day + '_open'"
                  [disabled]="shop.opening_hours[day]?.is_closed" class="input-control sm">
                <span>à</span>
                <input type="time" [(ngModel)]="shop.opening_hours[day]!.close" [name]="day + '_close'"
                  [disabled]="shop.opening_hours[day]?.is_closed" class="input-control sm">
              </div>
              <label class="switch">
                <input type="checkbox" [(ngModel)]="shop.opening_hours[day]!.is_closed" [name]="day + '_closed'"
                  (change)="onClosedToggle(day)">
                <span class="slider round"></span>
                <span class="switch-label">{{ shop.opening_hours[day]?.is_closed ? 'Fermé' : 'Ouvert' }}</span>
              </label>
            </div>
          </div>
        </div>

        <div class="form-actions mt-6">
          <button type="submit" class="btn-primary" [disabled]="isSavingShop">
            {{ isSavingShop ? 'Enregistrement...' : 'Enregistrer les modifications' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>