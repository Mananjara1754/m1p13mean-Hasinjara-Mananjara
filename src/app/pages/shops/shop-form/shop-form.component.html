<div class="page-container">
  <div class="header">
    <h2>{{ isEditMode ? 'Edit Shop' : 'Create New Shop' }}</h2>
    <a routerLink="/shops" class="btn-secondary">Back to List</a>
  </div>

  <form (ngSubmit)="onSubmit()" class="shop-form">
    <!-- Basic Info -->
    <div class="form-section">
      <h3>Basic Information</h3>
      <div class="form-group">
        <label>Shop Name</label>
        <input type="text" [(ngModel)]="shopData.name" name="name" required>
      </div>
      <div class="form-group">
        <label>Description</label>
        <textarea [(ngModel)]="shopData.description" name="description"></textarea>
      </div>
      <div class="form-group">
        <label>Shop Category (Organization)</label>
        <select [(ngModel)]="shopData.category_id" name="category_id">
          <option value="">Select a category</option>
          <option *ngFor="let cat of categories" [value]="cat._id">
            {{ cat.icon }} {{ cat.name }}
          </option>
        </select>
      </div>
      <div class="form-group">
        <label>Product Categories</label>
        <div class="product-categories-grid">
          <div *ngFor="let prodCat of productCategories" class="checkbox-item">
            <input type="checkbox" [id]="'prod_cat_' + prodCat._id" [checked]="isProductCategorySelected(prodCat._id)"
              (change)="toggleProductCategory(prodCat._id)">
            <label [for]="'prod_cat_' + prodCat._id">{{ prodCat.name }}</label>
          </div>
        </div>
      </div>
      <div class="form-group">
        <label>Logo</label>
        <input type="file" (change)="onLogoSelected($event)" accept="image/*">
      </div>
    </div>

    <!-- Location -->
    <div class="form-section" *ngIf="shopData.location">
      <h3>Location</h3>
      <div class="grid-2">
        <div class="form-group">
          <label>Floor</label>
          <input type="number" [(ngModel)]="shopData.location.floor" name="floor">
        </div>
        <div class="form-group">
          <label>Zone</label>
          <input type="text" [(ngModel)]="shopData.location.zone" name="zone">
        </div>
      </div>
      <div class="grid-2" *ngIf="shopData.location.map_position">
        <div class="form-group">
          <label>Map X</label>
          <input type="number" [(ngModel)]="shopData.location.map_position.x" name="map_x">
        </div>
        <div class="form-group">
          <label>Map Y</label>
          <input type="number" [(ngModel)]="shopData.location.map_position.y" name="map_y">
        </div>
      </div>
    </div>

    <!-- Rent -->
    <div class="form-section" *ngIf="shopData.rent">
      <h3>Rent & Billing</h3>
      <div class="grid-3">
        <div class="form-group">
          <label>Amount</label>
          <input type="number" [(ngModel)]="shopData.rent.amount" name="rent_amount">
        </div>
        <div class="form-group">
          <label>Currency</label>
          <input type="text" [(ngModel)]="shopData.rent.currency" name="rent_currency">
        </div>
        <div class="form-group">
          <label>Billing Cycle</label>
          <select [(ngModel)]="shopData.rent.billing_cycle" name="billing_cycle">
            <option value="monthly">Monthly</option>
            <option value="yearly">Yearly</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Opening Hours -->
    <div class="form-section" *ngIf="shopData.opening_hours">
      <h3>Opening Hours</h3>
      <div class="hours-grid">
        <div *ngFor="let day of days" class="hour-row">
          <div class="day-info">
            <span class="day-label capitalize">{{ day }}</span>
            <label class="closed-toggle">
              <input type="checkbox" [(ngModel)]="shopData.opening_hours[day].is_closed" [name]="day + '_closed'"
                (change)="onClosedToggle(day)">
              Closed
            </label>
          </div>
          <div class="time-inputs" [class.disabled]="shopData.opening_hours[day].is_closed">
            <input type="time" [(ngModel)]="shopData.opening_hours[day].open" [name]="day + '_open'"
              [disabled]="shopData.opening_hours[day].is_closed" (change)="onTimeChange(day)">
            <span>to</span>
            <input type="time" [(ngModel)]="shopData.opening_hours[day].close" [name]="day + '_close'"
              [disabled]="shopData.opening_hours[day].is_closed" (change)="onTimeChange(day)">
          </div>
        </div>
      </div>
    </div>

    <div class="form-actions">
      <button type="button" routerLink="/shops" class="btn-secondary">Cancel</button>
      <button type="submit" class="btn-primary" [disabled]="isLoading">
        {{ isLoading ? 'Saving...' : 'Save Shop' }}
      </button>
    </div>
  </form>
</div>